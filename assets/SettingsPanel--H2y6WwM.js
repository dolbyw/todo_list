import{c as h,d as _,u as H,r as J,w as K,a as P,b as k,e as X,f as g,o as d,g as t,h as y,i as u,X as G,j as C,k as f,v as V,l as q,m as w,n as b,t as v,p as M,C as Q,F as Y,q as Z,s as ee,T as te,K as o,x as j}from"./index-BDqWq_4J.js";/**
 * @license lucide-vue-next v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=h("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-vue-next v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=h("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]);/**
 * @license lucide-vue-next v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=h("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]]);/**
 * @license lucide-vue-next v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=h("wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]),oe={class:"h-full flex flex-col"},ne={class:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700 flex-shrink-0"},ie={class:"flex-1 overflow-y-auto p-6 space-y-6 min-h-0"},de={class:"space-y-4"},ue={class:"flex items-center justify-between"},ce={class:"relative inline-flex items-center cursor-pointer"},pe={key:0,class:"space-y-4"},ge={class:"flex items-center gap-3"},ye=["disabled"],fe={key:0,class:"flex items-center gap-2"},be={class:"flex items-center justify-between"},ve={class:"relative inline-flex items-center cursor-pointer"},xe={class:"space-y-4"},me={class:"space-y-3"},ke={class:"space-y-2"},we=["onClick"],he={class:"flex flex-col"},Se={class:"text-xs text-gray-300"},Ce={key:0,class:"w-2 h-2 bg-blue-500 rounded-full"},qe={class:"space-y-3"},je={class:"grid grid-cols-2 gap-2"},Ae={class:"space-y-4"},De={class:"space-y-3"},Ve={class:"p-6 bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm border-t border-gray-200 dark:border-gray-700 flex-shrink-0"},Me={class:"flex gap-3"},Fe=["disabled"],We=_({__name:"SettingsPanel",emits:["close"],setup(Te,{emit:F}){const T=F,{settings:A,tasks:U,lists:W,updateSettings:S,testWebDAVConnection:I}=H(),{applyFont:L}=P(),$=[{value:"System",label:"系统默认",description:"跟随操作系统设置"},{value:"MiSans",label:"MiSans",description:"小米定制字体，清晰优雅"}],s=J({...A.value});K(()=>s.fontFamily,l=>{L(l)});const p=k(!1),n=k(null),x=k(),m=k(!1),D=X(()=>s.webdav.url&&s.webdav.username&&s.webdav.password),O=async()=>{if(!D.value){o.error("请填写完整的WebDAV配置");return}p.value=!0,n.value=null;try{await S({webdav:s.webdav});const l=await I();n.value=l,l?o.success("WebDAV连接测试成功"):o.error("WebDAV连接测试失败")}catch(l){console.error("Connection test error:",l),n.value=!1,o.error("连接测试失败")}finally{p.value=!1}},z=async()=>{const l={theme:s.theme,webdav:{url:s.webdav.url,username:s.webdav.username,password:s.webdav.password,enabled:s.webdav.enabled},autoSync:s.autoSync,progressScope:s.progressScope,fontFamily:s.fontFamily};try{m.value=!0,await S(l),T("close")}catch(e){console.error("Save settings failed:",e),o.error("保存设置失败，请重试")}finally{m.value=!1}},B=()=>{const l={tasks:U.value,lists:W.value,settings:A.value,exportTime:new Date().toISOString()},e=new Blob([JSON.stringify(l,null,2)],{type:"application/json"}),a=URL.createObjectURL(e),r=document.createElement("a");r.href=a,r.download=`todo-backup-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(a),o.success("数据导出成功")},N=()=>{"serviceWorker"in navigator&&navigator.serviceWorker.controller?(navigator.serviceWorker.controller.postMessage({type:"CLEAR_CACHE"}),o.success("缓存清理指令已发送。应用将在刷新后使用最新版本。")):o.error("无法清理缓存：Service Worker 未激活。")},R=()=>{var l;(l=x.value)==null||l.click()},E=async l=>{var a;const e=(a=l.target.files)==null?void 0:a[0];if(e){try{const r=await e.text(),c=JSON.parse(r);if(!c.tasks||!c.lists)throw new Error("Invalid backup file format");if(!confirm("导入数据将覆盖当前所有数据，确定要继续吗？"))return;await j.clearAll(),await Promise.all([...c.tasks.map(i=>j.saveTask({...i,createdAt:new Date(i.createdAt),updatedAt:new Date(i.updatedAt)})),...c.lists.map(i=>j.saveList({...i,createdAt:new Date(i.createdAt),updatedAt:new Date(i.updatedAt)}))]),c.settings&&await S(c.settings),o.success("数据导入成功，请刷新页面"),setTimeout(()=>{window.location.reload()},1e3)}catch(r){console.error("Import error:",r),o.error("数据导入失败，请检查文件格式")}x.value&&(x.value.value="")}};return(l,e)=>(d(),g("div",oe,[t("div",ne,[e[9]||(e[9]=t("h2",{class:"text-xl font-bold text-gray-900 dark:text-white"},"设置",-1)),t("button",{onClick:e[0]||(e[0]=a=>l.$emit("close")),class:"p-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors"},[y(u(G),{class:"w-5 h-5"})])]),t("div",ie,[t("div",de,[t("div",ue,[e[11]||(e[11]=t("h3",{class:"text-lg font-medium text-white"}," WebDAV 同步 ",-1)),t("label",ce,[f(t("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>s.webdav.enabled=a),type:"checkbox",class:"sr-only peer"},null,512),[[V,s.webdav.enabled]]),e[10]||(e[10]=t("div",{class:"liquid-toggle w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"},null,-1))])]),s.webdav.enabled?(d(),g("div",pe,[t("div",null,[e[12]||(e[12]=t("label",{class:"block text-sm font-medium text-gray-200 mb-2"}," 服务器地址 ",-1)),f(t("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>s.webdav.url=a),type:"url",placeholder:"https://your-webdav-server.com/dav",class:"liquid-glass liquid-input w-full px-3 py-2 rounded-lg text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400"},null,512),[[q,s.webdav.url]])]),t("div",null,[e[13]||(e[13]=t("label",{class:"block text-sm font-medium text-gray-200 mb-2"}," 用户名 ",-1)),f(t("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>s.webdav.username=a),type:"text",placeholder:"用户名",class:"liquid-glass liquid-input w-full px-3 py-2 rounded-lg text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400"},null,512),[[q,s.webdav.username]])]),t("div",null,[e[14]||(e[14]=t("label",{class:"block text-sm font-medium text-gray-200 mb-2"}," 密码 ",-1)),f(t("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>s.webdav.password=a),type:"password",placeholder:"密码",class:"liquid-glass liquid-input w-full px-3 py-2 rounded-lg text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400"},null,512),[[q,s.webdav.password]])]),t("div",ge,[t("button",{onClick:O,disabled:p.value||!D.value,class:"liquid-glass liquid-button flex items-center gap-2 px-4 py-2 text-white rounded-lg disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},[y(u(re),{class:b(["w-4 h-4",{"animate-pulse":p.value}])},null,8,["class"]),w(" "+v(p.value?"测试中...":"测试连接"),1)],8,ye),n.value!==null?(d(),g("div",fe,[n.value?(d(),M(u(Q),{key:0,class:"w-5 h-5 text-green-500"})):(d(),M(u(se),{key:1,class:"w-5 h-5 text-red-500"})),t("span",{class:b(["text-sm",{"text-green-600 dark:text-green-400":n.value,"text-red-600 dark:text-red-400":!n.value}])},v(n.value?"连接成功":"连接失败"),3)])):C("",!0)]),t("div",be,[e[16]||(e[16]=t("div",null,[t("div",{class:"text-sm font-medium text-gray-200"}," 自动同步 "),t("div",{class:"text-xs text-gray-300"}," 应用启动时自动同步数据 ")],-1)),t("label",ve,[f(t("input",{"onUpdate:modelValue":e[5]||(e[5]=a=>s.autoSync=a),type:"checkbox",class:"sr-only peer"},null,512),[[V,s.autoSync]]),e[15]||(e[15]=t("div",{class:"liquid-toggle w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"},null,-1))])])])):C("",!0)]),t("div",xe,[e[23]||(e[23]=t("h3",{class:"text-lg font-medium text-white"}," 显示设置 ",-1)),t("div",me,[e[17]||(e[17]=t("div",{class:"text-sm font-medium text-gray-200"}," 字体选择 ",-1)),t("div",ke,[(d(),g(Y,null,Z($,a=>t("div",{key:a.value,onClick:r=>s.fontFamily=a.value,class:b(["liquid-glass flex items-center justify-between p-3 rounded-lg cursor-pointer transition-all duration-200 hover:scale-105",{"liquid-button":s.fontFamily===a.value,"opacity-60":s.fontFamily!==a.value}])},[t("div",he,[t("span",{class:"text-sm font-medium text-white",style:ee({fontFamily:a.value})},v(a.label),5),t("span",Se,v(a.description),1)]),s.fontFamily===a.value?(d(),g("div",Ce)):C("",!0)],10,we)),64))]),e[18]||(e[18]=t("div",{class:"text-xs text-gray-300"}," 选择应用的默认字体，更改后立即生效 ",-1))]),t("div",qe,[e[21]||(e[21]=t("div",{class:"text-sm font-medium text-gray-200"}," 完成进度显示范围 ",-1)),t("div",je,[t("button",{onClick:e[6]||(e[6]=a=>s.progressScope="current"),class:b(["liquid-glass flex items-center justify-center gap-2 p-3 rounded-lg transition-all duration-200 hover:scale-105 text-white",{"liquid-button":s.progressScope==="current","opacity-60":s.progressScope!=="current"}])},e[19]||(e[19]=[t("span",{class:"text-sm font-medium"},"当前列表",-1)]),2),t("button",{onClick:e[7]||(e[7]=a=>s.progressScope="all"),class:b(["liquid-glass flex items-center justify-center gap-2 p-3 rounded-lg transition-all duration-200 hover:scale-105 text-white",{"liquid-button":s.progressScope==="all","opacity-60":s.progressScope!=="all"}])},e[20]||(e[20]=[t("span",{class:"text-sm font-medium"},"全部任务",-1)]),2)]),e[22]||(e[22]=t("div",{class:"text-xs text-gray-300"}," 选择在侧边栏底部显示当前列表还是全部任务的完成进度 ",-1))])]),t("div",Ae,[e[27]||(e[27]=t("h3",{class:"text-lg font-medium text-white"}," 数据管理 ",-1)),t("div",De,[t("button",{onClick:B,class:"liquid-glass liquid-button w-full flex items-center justify-center gap-2 px-4 py-2 text-gray-700 dark:text-gray-300 rounded-lg transition-colors"},[y(u(ae),{class:"w-4 h-4"}),e[24]||(e[24]=w(" 导出数据 ",-1))]),t("button",{onClick:N,class:"liquid-glass liquid-button w-full flex items-center justify-center gap-2 px-4 py-2 text-gray-700 dark:text-gray-300 rounded-lg transition-colors"},[y(u(te),{class:"w-4 h-4"}),e[25]||(e[25]=w(" 清理缓存 ",-1))]),t("button",{onClick:R,class:"liquid-glass liquid-button w-full flex items-center justify-center gap-2 px-4 py-2 text-gray-700 dark:text-gray-300 rounded-lg transition-colors"},[y(u(le),{class:"w-4 h-4"}),e[26]||(e[26]=w(" 导入数据 ",-1))])])]),t("input",{ref_key:"fileInput",ref:x,type:"file",accept:".json",class:"hidden",onChange:E},null,544)]),t("div",Ve,[t("div",Me,[t("button",{onClick:e[8]||(e[8]=a=>l.$emit("close")),class:"flex-1 px-4 py-2 text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors"}," 取消 "),t("button",{onClick:z,disabled:m.value,class:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},v(m.value?"保存中...":"保存设置"),9,Fe)])])]))}});export{We as default};
